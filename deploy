#! /bin/sh
PLATFORM=`uname`

function build_vim {
    # roll our own VIM
  case $PLATFORM in
    SunOS)
      sudo pkgin -y install mercurial
      ;;
    Linux)
      sudo apt-get -y install libncurses5-dev python-dev mercurial
      sudo apt-get -y install cmake
      sudo apt-get -y remove vim vim-runtime gvim vim-tiny vim-common vim-gui-common
      ;;
  esac

  cd ~
  hg clone https://code.google.com/p/vim/
  cd vim
  hg checkout v7-3-1314
  case $PLATFORM in
    SunOS)
      ./configure --with-features=huge \
        --enable-rubyinterp \
        --enable-pythoninterp \
        --enable-cscope --prefix=/opt/local
      make VIMRUNTIMEDIR=/opt/local/share/vim/vim73
      ;;
    Linux)
      ./configure --with-features=huge \
        --enable-rubyinterp \
        --enable-pythoninterp \
        --enable-perlinterp \
        --enable-cscope --prefix=/usr
      make VIMRUNTIMEDIR=/usr/share/vim/vim73
      ;;
  esac
  sudo make install

  case $PLATFORM in
    Linux)
      sudo update-alternatives --install /usr/bin/editor editor /usr/bin/vim 1
      sudo update-alternatives --set editor /usr/bin/vim
      sudo update-alternatives --install /usr/bin/vi vi /usr/bin/vim 1
      sudo update-alternatives --set vi /usr/bin/vim
      ;;
  esac
}

case $PLATFORM in
  Darwin)
    ln -s $HOME/.darwin
    ;;
  SunOS)
		sudo pkgin -y install p5-ack
		sudo pkgin -y install zsh
		sudo usermod -s /opt/local/bin/zsh $USER
    ln -s $HOME/dotfiles/.sun
		build_vim
    ;;
  Linux)
    sudo apt-get -y install ack-grep
    sudo apt-get -y install zsh
    sudo chsh -s /usr/bin/zsh $USER
    sudo apt-get -y install curl
    ln -s $HOME/dotfiles/.linux
		build_vim
    ;;
esac

cd $HOME/dotfiles
git submodule init
git submodule update
cd .vim/bundle/YouCompleteMe
./install.sh

cd $HOME
curl -L https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh | sh

mv .zshrc .zshrc.orig
mv .vimrc .vimrc.orig
mv .gitconfig .gitconfig.orig

mkdir $HOME/bin
ln -s $HOME/dotfiles/.ackrc
ln -s $HOME/dotfiles/.default-difftool $HOME/bin/default-difftool.sh
ln -s $HOME/dotfiles/.gitconfig
ln -s $HOME/dotfiles/.vim
ln -s $HOME/dotfiles/.vimrc
ln -s $HOME/dotfiles/.zshrc
ln -s $HOME/dotfiles/angular-vim-snippets/UltiSnips $HOME/dotfiles/.vim/UltiSnipsAngular
